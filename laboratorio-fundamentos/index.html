<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lab Vue 2 - Semana 1</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      .grid-mangas {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 1.5rem;
      }

      .card-manga {
        border: 1px solid #ddd;
        border-radius: 8px;
        overflow: hidden;
      }

      .card-manga img {
        width: 100%;
        height: 250px;
        object-fit: cover;
      }
    </style>
  </head>
  <body class="bg-light">
    <div id="app" class="container mt-5">
      <h1 class="text-center">{{titulo}}</h1>
      <input
        v-model="busqueda"
        type="text"
        id="buscador"
        class="form-control my-4"
        placeholder="Buscar manga por título..."
      />
      <div v-if="cargando" class="alert alert-info text-center">
        Cargando mangas....
      </div>

      <div v-else>
        <div class="grid-mangas">
          <div
            class="card-manga"
            v-for="manga in mangasFiltrados"
            :key="manga.mal_id"
          >
            <img :src="manga.images.jpg.image_url" :alt="manga.title" />

            <div class="p-3">
              <h5>{{ manga.title }}</h5>
              <p>
                {{ manga.synopsis ? manga.synopsis.substring(0, 100) + '...' :
                'Sin sinopsis disponible.' }}
              </p>
            </div>
            <div class="p-3 text-center">
              <button class="btn btn-danger" @click="eliminarManga(manga.mal_id)">Eliminar</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <script>
      // AQUÍ ESCRIBIREMOS EL CÓDIGO JAVASCRIPT

      var app = new Vue({
        el: "#app",
        data: {
          titulo: "Lista de mangas",
          cargando: false,
          busqueda: "",
          mangas: [],
        },
        created() {
          this.cargando = true;
          axios
            .get("https://api.jikan.moe/v4/manga")
            .then((response) => {
              this.mangas = response.data.data;
              console.log(this.mangas);
            })
            .catch((error) => {
              console.error("Error al obtener los datos:", error);
            })
            .finally(() => {
              this.cargando = false;
            });
        },
        mounted() {
          console.log("La aplicación ha sido montada.");
        },
        computed: {
          mangasFiltrados() {
            const term = this.busqueda?.trim().toLowerCase();

            // Si no hay búsqueda → devuelve todo
            if (!term) {
              return this.mangas;
            }

            // Defensa: si mangas no es un array, devuelve vacío
            if (!Array.isArray(this.mangas)) {
              return [];
            }

            return this.mangas.filter((manga) =>
              manga.title?.toLowerCase().includes(term)
            );
          },
        },
        methods:{
            eliminarManga(id){
                this.mangas = this.mangas.filter(manga => manga.mal_id !== id);
            }
        },
        watch:{
            busqueda(nuevoValor, valorAntiguo){
                console.log(`Búsqueda cambiada de "${valorAntiguo}" a "${nuevoValor}"`);
            }
        }
      });
    </script>
  </body>
</html>
